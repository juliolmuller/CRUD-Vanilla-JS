"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Storage=function(){function n(t,e){if(_classCallCheck(this,n),this.constructor===n)throw new TypeError("Impossible to instance object of Storage class");this.name=t,this._storage=e,this.exists()?this.set(this.selectAll()):this.set([])}return _createClass(n,[{key:"exists",value:function(){return!!this._storage[this._name]}},{key:"set",value:function(t){this._storage.setItem(this._name,JSON.stringify(Array.from(t)))}},{key:"selectAll",value:function(){return Array.from(JSON.parse(this._storage.getItem(this._name)))}},{key:"select",value:function(t){return this.selectAll()[t]}},{key:"indexOf",value:function(n){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=-1;return this.selectAll().some(function(t,e){if(t[o||e]==n)return r=e,!0}),r}},{key:"insert",value:function(t){this.set(this.selectAll().concat(Array.of(t)))}},{key:"update",value:function(t,e){var n=this.selectAll();n[t]=e,this.set(n)}},{key:"delete",value:function(t){var e=this.selectAll();e.splice(t,1),this.set(e)}},{key:"clear",value:function(){this._storage.removeItem(this.name)}},{key:"count",get:function(){return this.selectAll().length}},{key:"name",set:function(t){if(void 0!==this._name)throw new TypeError("Cannot reset the name of an instanced Storage object");this._name=t},get:function(){return this._name}}]),n}(),LocalStorage=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,localStorage))}return _inherits(e,Storage),e}(),SessionStorage=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,sessionStorage))}return _inherits(e,Storage),e}();
"use strict";var Utils={formatDate:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd";return"yyyy-MM-dd"==e?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():"dd/MM/yyyy"==e?t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear():"dd/MM/yyyy hh:mm"==e?t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes():void 0},isName:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new RegExp("^([a-zA-Z"+(e?"À-ú":"")+" ])+$").test(t)},isEmail:function(t){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)},escapeHTML:function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})},valPassword:function(t){return!0},isCPF:function(t){var e=/[0-9]/,n=Array.from(t).filter(function(t){return e.test(t)});if(11<n.length)return!1;n.length<11&&(n="0".repeat(11-n.length).split("").concat(n).map(function(t){return parseInt(t)}));var u=[null,null],r=function(r){u[r]=10*Array.from(n).reverse().map(function(t,e){return r<e?t*e:void 0}).filter(function(t){return null!=t}).reduce(function(t,e){return t+e})%11};for(var a in u)r(a);var i=n.splice(9,2).reverse(),o=[!1,!1];for(var a in o)o[a]=i[a]==u[a];return o[0]===o[1]}};
"use strict";var REQUIRED_DATA=["name","email","password"],STORAGE=new LocalStorage("users");
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var User=function(){function e(t){_classCallCheck(this,e),this._errors={},this.name=t.name,this.gender=t.gender,this.birth=t.birth,this.country=t.country,this.email=t.email,this.password=t.password,this.photo=t.photo,this.admin=t.admin,this.registration=t.registration,this.id=t.id}return _createClass(e,[{key:"isRequired",value:function(t){return-1<REQUIRED_DATA.indexOf(t)}},{key:"getRowContent",value:function(){return'\n      <td><img src="'.concat(this.photo,'" alt="User Image" class="img-circle img-sm"></td>\n      <td>').concat(this.name,"</td>\n      <td>").concat(this.email,"</td>\n      <td>").concat(this.admin?"Yes":"No","</td>\n      <td>").concat(Utils.formatDate(this.registration,"dd/MM/yyyy hh:mm"),'</td>\n      <td>\n        <button type="button" class="btn btn-primary btn-edit btn-xs btn-flat">Edit</button>\n        <button type="button" class="btn btn-danger btn-delete btn-xs btn-flat">Delete</button>\n      </td>\n    ')}},{key:"hasErrors",value:function(){for(var t in this.errors)if(this._errors.hasOwnProperty(t))return!0;return!1}},{key:"setNewError",value:function(t,e){this._errors[t]=e}},{key:"errors",get:function(){return this._errors}},{key:"name",set:function(t){var e="name";!t&&this.isRequired(e)?this.setNewError(e,"User name is mandatory"):"string"==typeof t&&(t=t.trim(),Utils.isName(t)||this.setNewError(e,"User name contains invalid characters")),this._name=t},get:function(){return this._name}},{key:"gender",set:function(t){var e="gender";!t&&this.isRequired(e)&&this.setNewError(e,"No gender selected"),this._gender=t},get:function(){return this._gender}},{key:"birth",set:function(t){var e="birth";!t&&this.isRequired(e)&&this.setNewError(e,"Date of user birth is mandatory"),this._birth=t},get:function(){return this._birth}},{key:"country",set:function(t){var e="country";!t&&this.isRequired(e)&&this.setNewError(e,"User location is mandatory"),this._country=t},get:function(){return this._country}},{key:"email",set:function(t){var e="email";!t&&this.isRequired(e)?this.setNewError(e,"User email is mandatory"):"string"==typeof t&&(t=t.trim(),Utils.isEmail(t)||this.setNewError(e,"Email address contains invalid characters")),this._email=t},get:function(){return this._email}},{key:"password",set:function(t){var e="password";!t&&this.isRequired(e)?this.setNewError(e,"Password is mandatory"):"string"!=!_typeof(t)&&Utils.valPassword(t)||this.setNewError(e,"Password does not fit with the required format"),this._password=t},get:function(){return this._password}},{key:"photo",set:function(t){var e="photo";!t&&this.isRequired(e)&&this.setNewError(e,"No user profile image provided"),this._photo=t},get:function(){return this._photo}},{key:"admin",set:function(t){!t&&this.isRequired("admin")&&this.setNewError("admin",'Field "Administrator" must be checked'),this._admin=t},get:function(){return this._admin}},{key:"registration",set:function(t){this._registration=t?new Date(Date("".concat(t,"T00:00:00.000Z"))):new Date(Date("".concat(Date.now(),"T00:00:00.000Z")))},get:function(){return this._registration}},{key:"id",set:function(t){this._id=t||this._registration.getTime()},get:function(){return this._id}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var UserController=function(){function n(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;_classCallCheck(this,n),this.table=document.getElementById(e).getElementsByTagName("tbody")[0],this.boxFormCreate=document.getElementById(t),this.boxFormEdit=document.getElementById(r),this.formCreate=this.boxFormCreate.getElementsByTagName("form")[0],this.formEdit=this.boxFormEdit.getElementsByTagName("form")[0],this.addEventOnCancel(),this.addEventOnSUbmit(),this.refreshDisplayedData()}return _createClass(n,[{key:"addEventOnCancel",value:function(){var t=this;document.querySelectorAll(".btn-form-cancel").forEach(function(e){e.addEventListener("click",function(){e.form.reset(),t.displayNewUserForm(!0)})})}},{key:"addEventOnSUbmit",value:function(){var n=this;Array.of(this.formCreate,this.formEdit).forEach(function(r){r.addEventListener("submit",function(e){e.preventDefault();var t=r.dataset.userId?parseInt(r.dataset.userId):void 0;n.submit(t)})})}},{key:"submit",value:function(e){var t=this,r=e?this.formEdit:this.formCreate,n=r.querySelector("[type=submit]");n.disabled=!0,this.resetErrors();var a=this.getDataFromForm(r);if(a.id=e,a.hasErrors())for(var o in a.errors)console.log("Error in '".concat(o,"' => ").concat(a.errors[o]));else this.getPhoto(r).then(function(e){a.photo=e,t.saveUser(a),r.reset(),delete r.dataset.userId,t.displayNewUserForm(!0)},function(e){console.error(e)});n.disabled=!1}},{key:"resetErrors",value:function(){Array.of(this.formCreate,this.formEdit).forEach(function(e){e.querySelectorAll(".has-error").forEach(function(e){e.classList.remove("has-error")})})}},{key:"getPhoto",value:function(o){return new Promise(function(e,t){var r=new FileReader,n=o.querySelector("input[type=hidden][name=photo]").value,a=o.querySelector("input[type=file]").files[0];r.onload=function(){return e(r.result)},r.onerror=function(){return function(e){return t(e)}},a?r.readAsDataURL(a):e(n)})}},{key:"getDataFromForm",value:function(e){var t={};return e.querySelectorAll("[name]").forEach(function(e){switch(e.type){case"radio":e.checked&&(t[e.name]=e.value);break;case"checkbox":t[e.name]=e.checked;break;default:t[e.name]=e.value}}),new User(t)}},{key:"saveUser",value:function(e){var t=STORAGE.indexOf(e.id,"_id");-1<t?STORAGE.update(t,e):STORAGE.insert(e),this.refreshDisplayedData()}},{key:"displayNewUserForm",value:function(e){e?(this.boxFormEdit.style.display="none",this.boxFormCreate.style.display="block"):(this.boxFormCreate.style.display="none",this.boxFormEdit.style.display="block")}},{key:"refreshDisplayedData",value:function(){var a=this;this.table.innerHTML="";var o=0,i=0;STORAGE.selectAll().forEach(function(e){for(var t in e)e[t.replace("_","")]=e[t];var r=new User(e);o++,r.admin&&i++;var n=document.createElement("tr");n.dataset.userId=r.id,n.innerHTML=r.getRowContent(),n.querySelector(".btn-edit").addEventListener("click",function(){a.formEdit.dataset.userId=r.id,a.formEdit.querySelectorAll("[name]").forEach(function(e){if(r[e.name])switch(e.type){case"file":break;case"radio":e.value==r[e.name]&&(e.checked=!0);break;case"checkbox":e.checked=r[e.name];break;default:e.value=r[e.name]}}),a.displayNewUserForm(!1)}),n.querySelector(".btn-delete").addEventListener("click",function(){confirm("Are you sure you want to delete '".concat(r.name,"'?"))&&(STORAGE.delete(STORAGE.indexOf(r.id,"_id")),a.refreshDisplayedData())}),a.table.appendChild(n)}),document.getElementById("status-all-users").innerHTML=o,document.getElementById("status-admins").innerHTML=i}}]),n}();
"use strict";var user=new UserController("users-table","box-user-create","box-user-edit");